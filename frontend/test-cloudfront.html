<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudFront å‹•ä½œç¢ºèª</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px; 
            margin: 0 auto; 
            padding: 2rem; 
            background-color: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .success {
            background-color: #f0f9ff;
            border-left-color: #10b981;
            color: #065f46;
        }
        .error {
            background-color: #fef2f2;
            border-left-color: #ef4444;
            color: #991b1b;
        }
        .loading {
            background-color: #fef3c7;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        .button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        .button:hover {
            background-color: #2563eb;
        }
        pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ CloudFront å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
        <p>All Vault Cloud ã®CloudFrontè¨­å®šãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        
        <div>
            <button class="button" onclick="testFrontend()">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç¢ºèª</button>
            <button class="button" onclick="testAPI()">APIç¢ºèª</button>
            <button class="button" onclick="testAll()">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="button" onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        </div>
        
        <div id="test-results"></div>
        
        <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆè©³ç´°</h3>
        <div id="test-details"></div>
    </div>

    <script>
        const results = document.getElementById('test-results');
        const details = document.getElementById('test-details');
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function addDetails(content) {
            details.innerHTML += content;
        }
        
        function clearResults() {
            results.innerHTML = '';
            details.innerHTML = '';
        }
        
        async function testFrontend() {
            addResult('ğŸ”„ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç¢ºèªä¸­...', 'loading');
            
            try {
                // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
                addResult('âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: æ­£å¸¸è¡¨ç¤º (ã“ã®ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™)');
                
                // ç¾åœ¨ã®URLæƒ…å ±ã‚’è¡¨ç¤º
                const currentURL = window.location.href;
                addDetails(`<p><strong>ç¾åœ¨ã®URL:</strong> ${currentURL}</p>`);
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç¢ºèª
                const userAgent = navigator.userAgent;
                const isMobile = /Mobile|Android|iPhone|iPad/.test(userAgent);
                addDetails(`<p><strong>ãƒ‡ãƒã‚¤ã‚¹:</strong> ${isMobile ? 'ãƒ¢ãƒã‚¤ãƒ«' : 'ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—'}</p>`);
                
            } catch (error) {
                addResult(`âŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
            }
        }
        
        async function testAPI() {
            addResult('ğŸ”„ APIç¢ºèªä¸­...', 'loading');
            
            try {
                // API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
                addDetails('<h4>ğŸ“¡ API ãƒ†ã‚¹ãƒˆçµæœ:</h4>');
                
                // 1. PDFä¸€è¦§API
                const pdfResponse = await fetch('/api/uploads/pdf');
                addDetails(`<p>GET /api/uploads/pdf - Status: ${pdfResponse.status}</p>`);
                
                if (pdfResponse.ok) {
                    const pdfData = await pdfResponse.json();
                    addResult(`âœ… API (PDFä¸€è¦§): æ­£å¸¸å‹•ä½œ (${pdfData.files?.length || 0}ä»¶)`);
                    addDetails(`<pre>${JSON.stringify(pdfData, null, 2)}</pre>`);
                } else {
                    addResult(`âŒ API (PDFä¸€è¦§): HTTPã‚¨ãƒ©ãƒ¼ ${pdfResponse.status}`, 'error');
                }
                
                // 2. ç½²åä»˜ãURL API (POST)
                const presignedResponse = await fetch('/api/uploads/presigned-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        fileName: 'test.jpg',
                        fileType: 'image/jpeg'
                    })
                });
                
                addDetails(`<p>POST /api/uploads/presigned-url - Status: ${presignedResponse.status}</p>`);
                
                if (presignedResponse.ok) {
                    const presignedData = await presignedResponse.json();
                    addResult('âœ… API (ç½²åä»˜ãURL): æ­£å¸¸å‹•ä½œ');
                    addDetails(`<pre>${JSON.stringify(presignedData, null, 2)}</pre>`);
                } else {
                    addResult(`âŒ API (ç½²åä»˜ãURL): HTTPã‚¨ãƒ©ãƒ¼ ${presignedResponse.status}`, 'error');
                }
                
            } catch (error) {
                addResult(`âŒ API: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                addDetails(`<p>ã‚¨ãƒ©ãƒ¼è©³ç´°: ${error.stack}</p>`);
            }
        }
        
        async function testAll() {
            clearResults();
            addResult('ğŸš€ å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...', 'loading');
            
            await testFrontend();
            await testAPI();
            
            addResult('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º
        window.onload = function() {
            const now = new Date();
            addDetails(`<p><strong>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚åˆ»:</strong> ${now.toLocaleString('ja-JP')}</p>`);
            
            // CloudFront or é–‹ç™ºç’°å¢ƒã®åˆ¤å®š
            const isCloudFront = window.location.hostname.includes('cloudfront.net') || 
                               window.location.hostname === 'all-vault-cloud.com';
            const environment = isCloudFront ? 'æœ¬ç•ª (CloudFront)' : 'é–‹ç™ºç’°å¢ƒ';
            addDetails(`<p><strong>ç’°å¢ƒ:</strong> ${environment}</p>`);
        };
    </script>
</body>
</html>